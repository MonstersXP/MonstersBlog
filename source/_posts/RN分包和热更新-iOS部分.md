---
title: RN分包、增量更新 - iOS部分
date: 2020-08-10 11:21:32

description: 基础包预加载，监听基础包加载成功的消息，基础包加载后再加载业务包，顺序和时机控制 
categories: 性能优化
tags: [Objective-C]
toc: false 
---

### 背景

项目初期所有 React Native 业务都打成一个bundle，客户端在集成JS代码时由于压力过大，导致白屏和内存问题。

### 方案

将重复的 React Native 代码和第三方库打包成一个基础包，然后各个业务在基础包的 js 环境下运行，这样做可以减少内存开销且热更新的时候只需要下载对应的业务包，减少包大小。

### 客户端加载方案

基础包预加载，监听基础包加载成功的消息，基础包加载后再加载业务包，顺序和时机控制 

### 客户端加载方案

![](/img/RN分包和增量更新.png)

### 问题记录

**1**

![](/img/RN分包错误1.png)

是因为 JS 加载了一个  RCTEventEitter 的子类。原生没有导致

![](/img/RN分包错误1解析.png)

**2**

![](/img/RN分包错误2.png)

加载业务时基础包没有加载好或者加载失败，需要提前加载基础包

**3** 

第一次打开业务正常，后面都是白屏，是因为页面销毁的时候将已加载的 JS 释放了

![](/img/RN分包错误3.png)

**4**

![](/img/RN分包错误4.png)

JS 使用了 RNSmartassete 原生没有

![](/img/RN分包错误4解析.png)

###最后

搭配上自动化工具和脚本，效率提升极大。

时间匆忙，简要记录。